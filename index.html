<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ƒåœ’å¸‚å…¬è»Šç‡Ÿé‹è©•é‘‘å¡«å ±ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="%23ffffff" opacity="0.03"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.12),
                0 16px 32px rgba(0, 0, 0, 0.08),
                0 8px 16px rgba(0, 0, 0, 0.04);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            position: relative;
            z-index: 2;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #6dd5ed 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            animation: headerShine 3s ease-in-out infinite;
        }

        @keyframes headerShine {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
            100% { transform: translateX(100%); }
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 2px,
                rgba(255,255,255,0.05) 2px,
                rgba(255,255,255,0.05) 4px
            );
            animation: shimmer 20s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .nav-tabs {
            display: flex;
            background: linear-gradient(to right, #f8f9fa 0%, #ffffff 100%);
            overflow-x: auto;
            border-bottom: 3px solid #e9ecef;
            position: relative;
            box-shadow: inset 0 -1px 0 rgba(0,0,0,0.05);
        }

        .nav-tabs::before {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #2193b0, #6dd5ed, #2193b0);
            background-size: 200% 100%;
            animation: tabsGlow 4s ease-in-out infinite;
        }

        @keyframes tabsGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .nav-tab {
            padding: 18px 28px;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            position: relative;
            color: #495057;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(33, 147, 176, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-tab:hover {
            background: linear-gradient(135deg, rgba(33, 147, 176, 0.08) 0%, rgba(109, 213, 237, 0.08) 100%);
            color: #1a73e8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 147, 176, 0.15);
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #1e3c72 0%, #2193b0 100%);
            color: white;
            box-shadow: 
                0 4px 15px rgba(33, 147, 176, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #2193b0;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 28px;
            padding: 24px;
            border: 1px solid rgba(233, 236, 239, 0.8);
            border-radius: 16px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .form-group::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #2193b0, #6dd5ed);
            transition: left 0.6s ease;
        }

        .form-group:hover {
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.1),
                0 4px 12px rgba(0, 0, 0, 0.05);
            transform: translateY(-3px);
            border-color: rgba(33, 147, 176, 0.3);
        }

        .form-group:hover::before {
            left: 0;
        }

        .form-group h3 {
            color: #1e3c72;
            margin-bottom: 18px;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            position: relative;
            padding-bottom: 8px;
        }

        .form-group h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #2193b0, #6dd5ed);
            border-radius: 2px;
        }

        .form-group h3::before {
            content: 'ğŸ“‹';
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        .form-field label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-field input,
        .form-field select,
        .form-field textarea {
            padding: 14px 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 400;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            position: relative;
        }

        .form-field input:focus,
        .form-field select:focus,
        .form-field textarea:focus {
            outline: none;
            border-color: #2193b0;
            box-shadow: 
                0 0 0 4px rgba(33, 147, 176, 0.12),
                0 2px 8px rgba(33, 147, 176, 0.15);
            background: #ffffff;
            transform: translateY(-1px);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .checkbox-item:hover {
            background: linear-gradient(135deg, rgba(33, 147, 176, 0.08) 0%, rgba(109, 213, 237, 0.05) 100%);
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(33, 147, 176, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 28px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(33, 147, 176, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #adb5bd 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #e9ecef 0%, #f8f9fa 100%);
            border-radius: 4px;
            margin: 24px 0;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2193b0 50%, #6dd5ed 100%);
            border-radius: 4px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
            position: relative;
            box-shadow: 0 0 10px rgba(33, 147, 176, 0.5);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressFillShine 1.5s ease-in-out infinite;
        }

        @keyframes progressFillShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .auto-calculate {
            background: #e8f4fd;
            border: 1px solid #b8daff;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
            color: #0c5460;
        }

        .validation-error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 500;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
        }

        .section-divider {
            border-top: 2px solid #2193b0;
            margin: 30px 0;
            position: relative;
        }

        .section-divider::after {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: #6dd5ed;
        }

        .station-entry {
            background: #ffffff;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .station-entry h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .required {
            color: #dc3545;
        }

        .field-help {
            font-size: 12px;
            color: #6c757d;
            margin-top: 3px;
        }

        /* æˆåŠŸæäº¤å½ˆçª—æ¨£å¼ */
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .success-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .success-modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.15),
                0 16px 32px rgba(0, 0, 0, 0.1);
            transform: scale(0.7) translateY(50px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .success-modal.show .success-modal-content {
            transform: scale(1) translateY(0);
        }

        .success-modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #28a745, #20c997, #17a2b8);
            animation: modalTopShine 2s ease-in-out infinite;
        }

        @keyframes modalTopShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: successPulse 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(40, 167, 69, 0.3);
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(40, 167, 69, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(40, 167, 69, 0.5); }
        }

        .success-icon::before {
            content: 'âœ“';
            font-size: 40px;
            color: white;
            font-weight: bold;
            animation: checkmarkDraw 0.6s ease-in-out 0.3s both;
        }

        @keyframes checkmarkDraw {
            0% { transform: scale(0) rotate(45deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .success-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 15px;
            animation: titleSlideIn 0.6s ease-out 0.5s both;
        }

        @keyframes titleSlideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .success-message {
            font-size: 1.1rem;
            color: #495057;
            margin-bottom: 25px;
            line-height: 1.6;
            animation: messageSlideIn 0.6s ease-out 0.7s both;
        }

        @keyframes messageSlideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .success-details {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border: 1px solid #c3e6cb;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 25px;
            font-size: 14px;
            color: #155724;
            animation: detailsSlideIn 0.6s ease-out 0.9s both;
        }

        @keyframes detailsSlideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .success-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            animation: buttonsSlideIn 0.6s ease-out 1.1s both;
        }

        @keyframes buttonsSlideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%);
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(33, 147, 176, 0.3);
        }

        .modal-btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #adb5bd 100%);
            color: white;
        }

        .modal-btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: confettiFall 3s ease-out infinite;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>114å¹´åº¦æ¡ƒåœ’å¸‚å¸‚å€æ±½è»Šå®¢é‹ç‡Ÿé‹èˆ‡æœå‹™è©•é‘‘</h1>
            <p>æ›¸é¢è³‡æ–™å¯©æŸ¥å¡«å ±ç³»çµ± (113.11.01~114.10.31)</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection(event, 'categoryA')">Aå ´ç«™è¨­æ–½èˆ‡æœå‹™</button>
            <button class="nav-tab" onclick="showSection(event, 'categoryB')">Bé‹è¼¸å·¥å…·è¨­å‚™èˆ‡å®‰å…¨</button>
            <button class="nav-tab" onclick="showSection(event, 'categoryD')">Då…¬å¸ç¶“ç‡Ÿèˆ‡ç®¡ç†</button>
            <button class="nav-tab" onclick="showSection(event, 'categoryE')">Eç„¡éšœç¤™ä¹‹å ´ç«™è¨­æ–½ã€æœå‹™ã€é‹è¼¸è¨­å‚™èˆ‡å®‰å…¨</button>
            <button class="nav-tab" onclick="showSection(event, 'categoryF')">F. æ€§åˆ¥å¹³ç­‰</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="content">
            <!-- Aé¡é …ç›® -->
            <div class="section active" id="categoryA">
                <div class="form-group">
                    <h3>å…¬å¸åŸºæœ¬è³‡æ–™</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="companyName">å…¬å¸åç¨± <span class="required">*</span></label>
                            <input type="text" id="companyName" required>
                        </div>
                        <div class="form-field">
                            <label for="fillPerson">å¡«å¯«äººå“¡ <span class="required">*</span></label>
                            <input type="text" id="fillPerson" required>
                        </div>
                        <div class="form-field">
                            <label for="fillDate">å¡«è¡¨æ—¥æœŸ <span class="required">*</span></label>
                            <input type="date" id="fillDate" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(A1) å ´ç«™ç©ºé–“</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="totalVehicles">å¸‚å€å…¬è»Šç‡Ÿé‹è·¯ç·šç¸½è»Šè¼›æ•¸ <span class="required">*</span></label>
                            <input type="number" id="totalVehicles" required onchange="calculateParkingRatio()">
                        </div>
                    </div>
                    
                    <div id="stationsContainer">
                        <div class="station-entry">
                            <h4>å ´ç«™ 1</h4>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>å ´ç«™åç¨±</label>
                                    <input type="text" class="station-name">
                                </div>
                                <div class="form-field">
                                    <label>åœæ”¾é¢ç© (å¹³æ–¹å…¬å°º)</label>
                                    <input type="number" class="station-area">
                                </div>
                                <div class="form-field">
                                    <label>æ ¼ä½æ•¸</label>
                                    <input type="number" class="station-spaces" onchange="calculateParkingRatio()">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-secondary" onclick="addStation()">æ–°å¢å ´ç«™</button>
                    

                </div>
            </div>

            <!-- Bé¡é …ç›® -->
            <div class="section" id="categoryB">
                <!-- B1 -->
                <div class="form-group">
                    <h3>(B1) è»Šé½¡æ¯”ç‡</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="totalTrips">ç¸½ç­æ¬¡æ•¸</label>
                            <input type="number" id="totalTrips">
                        </div>
                        <div class="form-field">
                            <label for="avgAge">å¹³å‡è»Šé½¡ (å¹´)</label>
                            <input type="number" step="0.1" id="avgAge">
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="hasVehicleProof">
                            <label for="hasVehicleProof">æä¾›è»Šç±è­‰æ˜è³‡æ–™</label>
                        </div>
                    </div>
                </div>

                <!-- B3 -->
                <div class="form-group">
                    <h3>(B3) æ’æ”¾å»¢æ°£å“è³ª</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="totalVehiclesB3">ç¸½è»Šè¼›æ•¸</label>
                            <input type="number" id="totalVehiclesB3" onchange="calculateEmissionRatio()">
                        </div>
                        <div class="form-field">
                            <label for="dieselVehicles">æŸ´æ²¹è»Šæ•¸é‡</label>
                            <input type="number" id="dieselVehicles" onchange="calculateEmissionRatio()">
                        </div>
                        <div class="form-field">
                            <label for="electricVehicles">é›»å‹•è»Šæ•¸é‡</label>
                            <input type="number" id="electricVehicles" onchange="calculateEmissionRatio()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="hybridVehicles">æ²¹é›»æ··åˆè»Šæ•¸é‡</label>
                            <input type="number" id="hybridVehicles" onchange="calculateEmissionRatio()">
                        </div>
                        <div class="form-field">
                            <label for="gasolineVehicles">æ±½æ²¹è»Šæ•¸é‡</label>
                            <input type="number" id="gasolineVehicles" onchange="calculateEmissionRatio()">
                        </div>
                        <div class="form-field">
                            <label for="otherVehicles">å…¶ä»–è»Šè¼›æ•¸é‡</label>
                            <input type="number" id="otherVehicles" onchange="calculateEmissionRatio()">
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="dieselManagementProof">
                            <label for="dieselManagementProof">æä¾›æŸ´æ²¹è»Šè‡ªä¸»ç®¡ç†æ¨™ç« åˆæ ¼è³‡æ–™</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="gasolineEmissionTest">
                            <label for="gasolineEmissionTest">æä¾›æ±½æ²¹è»Šæ’æ°£å®šæª¢è³‡æ–™</label>
                        </div>
                    </div>

                </div>

                <!-- B4 -->
                <div class="form-group">
                    <h3>(B4) æ¶ˆé˜²å®‰å…¨è¨­æ–½</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="hasExtinguisherPhoto">
                            <label for="hasExtinguisherPhoto">æä¾›è»Šè¼›å…§æ»…ç«å™¨ç…§ç‰‡</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="extinguisherNormal">
                            <label for="extinguisherNormal">æ»…ç«å™¨å‡åœ¨æœ‰æ•ˆæœŸé™å…§ä¸”å£“åŠ›è¡¨æ­£å¸¸</label>
                        </div>
                    </div>
                    <div class="form-field">
                        <label for="extinguisherIssue">æ»…ç«å™¨ç•°å¸¸åŸå›  (å¦‚æœ‰)</label>
                        <textarea id="extinguisherIssue" rows="3"></textarea>
                    </div>
                </div>

                <!-- B5 -->
                <div class="form-group">
                    <h3>(B5) è¡Œè»Šè¨˜éŒ„å™¨ä¹‹è¨­ç½®èˆ‡ç®¡ç†</h3>
                    <div class="form-field">
                        <label>è·¯ç·šå½¢å¼</label>
                        <select id="routeType">
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="taoyuan_bus">æ¡ƒå°å·´è·¯ç·š</option>
                            <option value="other">å…¶ä»–è·¯ç·š</option>
                        </select>
                    </div>
                    
                    <div id="otherRouteFields" style="display: none;">
                        <h4>å¤§å®¢è»Šå°ˆç”¨è¡Œè»Šç´€éŒ„å™¨ç®¡ç†</h4>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="hasStatReport">
                                <label for="hasStatReport">å®šæœŸæŸ¥æ ¸çµ±è¨ˆå ±è¡¨ - è³‡æ–™å®Œæ•´</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hasRewardPunish">
                                <label for="hasRewardPunish">è¨‚å®šæŸ¥æ ¸çæ‡²è¾¦æ³• - è³‡æ–™å®Œæ•´</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hasExecution">
                                <label for="hasExecution">çæ‡²å¯¦éš›åŸ·è¡Œè¨˜éŒ„ - è³‡æ–™å®Œæ•´</label>
                            </div>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h4>å½±åƒå¼è¡Œè»Šè¨˜éŒ„å™¨ä¿å­˜æ™‚é–“</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="video14Days">
                            <label for="video14Days">ä¿å­˜14å¤©(å«)ä»¥ä¸Š - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="video7to14Days">
                            <label for="video7to14Days">ä¿å­˜7(å«)~14å¤© - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="videoUnder7Days">
                            <label for="videoUnder7Days">ä¿å­˜7å¤©ä»¥ä¸‹ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="canProvideVideo">
                            <label for="canProvideVideo">å¯æ–¼ç°¡å ±æ™‚æä¾›æŒ‡å®šè·¯ç·šã€æ—¥æœŸåŠæ™‚é–“ä¹‹è¡Œè»Šç´€éŒ„å½±åƒ</label>
                        </div>
                    </div>
                </div>

                <!-- B6 -->
                <div class="form-group">
                    <h3>(B6) è»Šè¼›ç¶­ä¿®ä¿é¤Šåˆ¶åº¦åŠåŸ·è¡Œæƒ…å½¢</h3>
                    <div class="form-field">
                        <label>è»Šè¼›ä¿é¤Šæ–¹æ³•</label>
                        <select id="maintenanceType">
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="own">è‡ªæœ‰ä¿é¤Šå» </option>
                            <option value="outsource">å§”å¤–ä¿é¤Š</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="safetyCheckForm">
                            <label for="safetyCheckForm">å‡ºè»Šå®‰å…¨æª¢æŸ¥è¡¨ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="maintenanceRecord">
                            <label for="maintenanceRecord">è»Šè¼›å„ç´šä¿é¤Šç´€éŒ„å¡ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="maintenanceProcedure">
                            <label for="maintenanceProcedure">ä¸€èˆ¬ä¿é¤Šç¨‹åºè¦ç«  - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="partsInventory">
                            <label for="partsInventory">è»Šå» å‚™æ–™ç‹€æ³ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="certifiedTechnician">
                            <label for="certifiedTechnician">åˆæ ¼å°ˆæ¥­æŠ€å¸«/æŠ€å·¥ - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>
                </div>

                <!-- B7 -->
                <div class="form-group">
                    <h3>(B7) é›»å‹•è»Šæ¯”ç‡èˆ‡è³¼ç½®</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="totalVehiclesB7">å¸‚å€å…¬è»Šç‡Ÿé‹è·¯ç·šç¸½è»Šè¼›æ•¸</label>
                            <input type="number" id="totalVehiclesB7" onchange="calculateElectricRatio()">
                        </div>
                        <div class="form-field">
                            <label for="electricVehiclesB7">é›»å‹•è»Šç¸½è»Šè¼›æ•¸</label>
                            <input type="number" id="electricVehiclesB7" onchange="calculateElectricRatio()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="purchasedElectric">è©•é‘‘æœŸé–“å…§æ¡è³¼ä½†æœªäº¤è»Šé›»å‹•è»Šæ•¸é‡</label>
                            <input type="number" id="purchasedElectric">
                        </div>
                        <div class="form-field">
                            <label for="unsuitableRoute">ä¸é©åˆä½¿ç”¨é›»å‹•è»Šè·¯ç·šä¹‹è»Šè¼›æ•¸</label>
                            <input type="number" id="unsuitableRoute">
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h4>é›»å‹•è»Šè³¼ç½®èˆ‡æ±°æ›</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="electricPurchaseData">
                            <label for="electricPurchaseData">è©•é‘‘æœŸé–“å…§é›»å‹•è»Šè³¼ç½®è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="vehicleReplacementData">
                            <label for="vehicleReplacementData">è©•é‘‘æœŸé–“å…§å…¬è»Šæ±°æ›è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dé¡é …ç›® -->
            <div class="section" id="categoryD">
                <div class="form-group">
                    <h3>(D2) äº¤é€šé•è¦åŠè¡Œè»Šè‚‡äº‹ç‡</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="totalMileage">æœŸé–“ç¸½é‡Œç¨‹æ•¸ (å…¬é‡Œ)</label>
                            <input type="number" id="totalMileage" onchange="calculateAccidentRate()">
                        </div>
                        <div class="form-field">
                            <label for="a1Accidents">A1äº‹æ•…ä»¶æ•¸</label>
                            <input type="number" id="a1Accidents" onchange="calculateAccidentRate()">
                        </div>
                        <div class="form-field">
                            <label for="a2Accidents">A2äº‹æ•…ä»¶æ•¸</label>
                            <input type="number" id="a2Accidents" onchange="calculateAccidentRate()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="trafficViolations">äº¤é€šé•è¦è¢«èˆ‰ç™¼ä»¶æ•¸</label>
                            <input type="number" id="trafficViolations" onchange="calculateViolationRate()">
                        </div>
                    </div>


                </div>



                <div class="form-group">
                    <h3>(D4) æ”¿ç­–é…åˆ</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="intersectionTraining">
                            <label for="intersectionTraining">è·¯å£åœè®“æ•™è‚²è¨“ç·´ - æœ‰ä½è­‰è³‡æ–™</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="intersectionExecution">
                            <label for="intersectionExecution">è·¯å£åœè®“åŸ·è¡Œç‹€æ³ - æœ‰ä½è­‰è³‡æ–™</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="innovativeService">
                            <label for="innovativeService">å‰µæ–°æœå‹™é …ç›® - æœ‰ä½è­‰è³‡æ–™</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="newRoutes">
                            <label for="newRoutes">å…¬è»Šæ–°é—¢æˆ–è©¦è¾¦è·¯ç·š - æœ‰ä½è­‰è³‡æ–™</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(D5) äººå“¡ç®¡ç†èˆ‡æ•™è‚²è¨“ç·´</h3>
                    
                    <h4>å¿…è¦è¨“ç·´èª²ç¨‹</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="fireTraining">
                            <label for="fireTraining">æ¶ˆé˜²åŠç·Šæ€¥æ‡‰è®Šå±æ©Ÿè™•ç†è¨“ç·´ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="elderlyTraining">
                            <label for="elderlyTraining">é§•é§›é«˜é½¡å‹å–„æœå‹™è¨“ç·´ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="disabilityTraining">
                            <label for="disabilityTraining">é§•é§›èº«éšœæœå‹™åŠè¨­å‚™æ“ä½œè¨“ç·´ - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h4>ç”³è¨´å›è¨“èˆ‡å®£å°</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="complaintTraining">
                            <label for="complaintTraining">é§•é§›ç”³è¨´æˆ–ç¨½æŸ¥ç¼ºå¤±å›è¨“åŠå®£å° - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h4>å‡ºå‹¤å‰æª¢æ¸¬</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="alcoholTest">
                            <label for="alcoholTest">å‡ºè»Šå‰é…’æ¸¬ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="temperatureTest">
                            <label for="temperatureTest">å‡ºè»Šå‰é‡é«”æº« - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="bloodPressureTest">
                            <label for="bloodPressureTest">å‡ºè»Šå‰é‡è¡€å£“ - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h4>å…¶ä»–ç®¡ç†æªæ–½</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="rewardPunishment">
                            <label for="rewardPunishment">è¨­ç«‹çæ‡²è¦å®šï¼Œä¸¦ä»˜è«¸åŸ·è¡Œ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="disasterDrill">
                            <label for="disasterDrill">è½å¯¦é˜²ç½å¯¦éš›æ¼”ç·´ - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(D6) ç›£ç£ç®¡ç†</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="accidentReport">
                            <label for="accidentReport">è¡Œè»Šäº‹æ•…é€šå ±èˆ‡è™•ç† - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="trafficLawPromotion">
                            <label for="trafficLawPromotion">è½å¯¦å®£å°äº¤é€šæ³•è¦æ”¿ç­– - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="accountingSystem">
                            <label for="accountingSystem">ç¢ºå¯¦åŸ·è¡Œäº¤é€šéƒ¨æœƒè¨ˆåˆ¶åº¦ - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(D7) ä¿éšªç‹€æ³</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="passengerInsurance">
                            <label for="passengerInsurance">ä¹˜å®¢æ„å¤–éšªæŠ•ä¿ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="thirdPartyInsurance">
                            <label for="thirdPartyInsurance">ç¬¬ä¸‰äººè²¬ä»»éšªæŠ•ä¿ - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(D8) å…¬å¸è¡Œè»Šå®‰å…¨åˆ¶åº¦ä¹‹å®Œæ•´æ€§èˆ‡è½å¯¦ç¨‹åº¦</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="driverMentalManagement">
                            <label for="driverMentalManagement">é§•é§›å“¡èº«å¿ƒç®¡ç†åˆ¶åº¦ - è³‡æ–™å®Œæ•´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="drivingInspection">
                            <label for="drivingInspection">è¡Œè»Šç¨½æŸ¥ç®¡ç†ä½œæ¥­ - è³‡æ–™å®Œæ•´</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(D9) å‰æœŸç¼ºå¤±æ”¹å–„æƒ…å½¢</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="prevStopDefects">å‰æœŸç«™ç‰Œç›¸é—œç¼ºå¤±é …ç›®</label>
                            <input type="number" id="prevStopDefects" onchange="calculateImprovementRatio()">
                        </div>
                        <div class="form-field">
                            <label for="improvedStopDefects">å·²æ”¹å–„ç«™ç‰Œç¼ºå¤±é …ç›®</label>
                            <input type="number" id="improvedStopDefects" onchange="calculateImprovementRatio()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="prevVehicleDefects">å‰æœŸéš¨è»Šèª¿æŸ¥è¨­å‚™ç›¸é—œç¼ºå¤±é …ç›®</label>
                            <input type="number" id="prevVehicleDefects" onchange="calculateImprovementRatio()">
                        </div>
                        <div class="form-field">
                            <label for="improvedVehicleDefects">å·²æ”¹å–„éš¨è»Šè¨­å‚™ç¼ºå¤±é …ç›®</label>
                            <input type="number" id="improvedVehicleDefects" onchange="calculateImprovementRatio()">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(D10) é•åå‹åŸºæ³•</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="totalMileageD10">æœŸé–“ç¸½é‡Œç¨‹æ•¸ (å…¬é‡Œ)</label>
                            <input type="number" id="totalMileageD10">
                        </div>
                        <div class="form-field">
                            <label for="laborViolations">å‹åŸºæ³•é•è¦æ¬¡æ•¸</label>
                            <input type="number" id="laborViolations">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Eé¡é …ç›® -->
            <div class="section" id="categoryE">
                <div class="form-group">
                    <h3>(E3) ç„¡éšœç¤™é‹è¼¸å·¥å…·</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="accessibleTotal">ä¸å«å±±å€/é«˜å¿«é€Ÿè·¯ç·šåŠä¸­å°å‹å·´å£«ä¹‹ç¸½è»Šè¼›æ•¸</label>
                            <input type="number" id="accessibleTotal" onchange="calculateAccessibleRatio()">
                        </div>
                        <div class="form-field">
                            <label for="accessibleVehicles">ç„¡éšœç¤™è»Šè¼›æ•¸é‡(å«ä½åœ°æ¿å…¬è»ŠåŠå…·å‚™å‡é™è¨­å‚™å…¬è»Š)</label>
                            <input type="number" id="accessibleVehicles" onchange="calculateAccessibleRatio()">
                        </div>
                    </div>

                </div>
            </div>

            <!-- Fé¡é …ç›® -->
            <div class="section" id="categoryF">

                <div class="form-group">
                    <h3>(F1) æ€§åˆ¥å¹³ç­‰æ³•ä»¤è¦ç¯„</h3>
                    
                    <h4>ä¼‘å‡è¦å®š</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="maternityLeave">
                            <label for="maternityLeave">æä¾›ç”¢å‡</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="prenatalLeave">
                            <label for="prenatalLeave">æä¾›ç”¢æª¢å‡</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="paternityLeave">
                            <label for="paternityLeave">æä¾›é™ªç”¢å‡</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="menstrualLeave">
                            <label for="menstrualLeave">æä¾›ç”Ÿç†å‡</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="familyCareLeave">
                            <label for="familyCareLeave">æä¾›å®¶åº­ç…§é¡§å‡</label>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h4>è‚²å¬°è¦å®š</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="parentalLeave">
                            <label for="parentalLeave">æä¾›è‚²å¬°ç•™è·åœè–ªæªæ–½</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(F2) è‚²å…’ç›¸é—œæªæ–½</h3>
                    <div class="form-field">
                        <label>å“¡å·¥äººæ•¸</label>
                        <select id="employeeCount">
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="under100">æœªé”100å“¡(ä¸å«)</option>
                            <option value="over100">æœ‰é”100å“¡(å«)</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="childcareFacilities">
                            <label for="childcareFacilities">æä¾›å“¡å·¥è‚²å…’å‹å–„ç’°å¢ƒæˆ–æªæ–½</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="maternalHealth">
                            <label for="maternalHealth">æä¾›æ¯æ€§å¥åº·ä¿è­·æªæ–½</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h3>(F3) æ€§åˆ¥å®‰å…¨ç›¸é—œæªæ–½</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="nightWorkSafety">
                            <label for="nightWorkSafety">å¥³æ€§å¤œé–“å·¥ä½œå®‰å…¨è¡›ç”Ÿæªæ–½</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="harassmentTraining">
                            <label for="harassmentTraining">å¼·åŒ–æœå‹™äººå“¡å°æ€§é¨·æ“¾äº‹ä»¶è™•ç†èƒ½åŠ›ä¹‹è¨“ç·´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="harassmentPolicy">
                            <label for="harassmentPolicy">è¨‚å®šæ€§é¨·æ“¾é˜²æ²»æªæ–½ï¼Œä¸¦å…¬é–‹æ­ç¤º</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="harassmentPrevention">
                            <label for="harassmentPrevention">é˜²ç¯„æ’é™¤(æ’­æ”¾æ€§é¨·æ“¾é˜²æ²»å®£å°å½±ç‰‡ã€å¼µè²¼å®£å°æ¨™èª...)</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button type="button" class="btn btn-primary" onclick="prevSection()">ä¸Šä¸€é </button>
                <button type="button" class="btn btn-primary" onclick="nextSection()">ä¸‹ä¸€é </button>
                <button type="button" class="btn btn-secondary" onclick="saveProgress()">å„²å­˜é€²åº¦</button>
                <button type="button" class="btn btn-success" onclick="submitForm()">æäº¤è¡¨å–®</button>
                <!-- <button id="exportBtn" type="button" class="btn btn-secondary" onclick="exportExcel()" disabled>åŒ¯å‡ºâ€¯Excel</button> -->
                <button type="button" class="btn btn-danger" onclick="resetForm()">é‡ç½®è¡¨å–®</button>
            </div>
        </div>
    </div>

    <script>
       let currentSection = 0;
       const sections = ['categoryA','categoryB','categoryD','categoryE','categoryF'];
      let stationCount = 1;

      // åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
          document.getElementById('fillDate').value = new Date().toISOString().split('T')[0];
          loadProgress();
           showSectionById('categoryA');  // ä¸€é€²é é¢å°±åˆ‡åˆ°ã€ŒAé¡é …ç›®ã€
          updateProgress();
          document.getElementById('routeType')?.addEventListener('change', function() {
            document.getElementById('otherRouteFields').style.display =
              this.value==='other' ? 'block' : 'none';
          });
          setInterval(autoSave,60000);
      });

      // åˆ‡åˆ†é 
      function showSection(evt, id) {
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        const el = evt && (evt.currentTarget || evt.target);
        if (el && el.classList) el.classList.add('active');
        currentSection = sections.indexOf(id);
        const btn = document.querySelector('[onclick="submitForm()"]');
        if(btn) btn.className = id==='categoryF'?'btn btn-success':'btn btn-secondary';
        updateProgress();
      }
      function showSectionById(id) {
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        const tab = document.querySelector(`[onclick="showSection(event, '${id}')"]`);
        if(tab) tab.classList.add('active');
        const btn = document.querySelector('[onclick="submitForm()"]');
        if(btn) btn.className = id==='categoryF'?'btn btn-success':'btn btn-secondary';
        updateProgress();
      }

      // ä¸Šä¸€ï¼ä¸‹ä¸€é 
      function prevSection() {
        if(currentSection>0) showSectionById(sections[--currentSection]);
      }
      function nextSection() {
        if(currentSection<sections.length-1) showSectionById(sections[++currentSection]);
      }

      // æ›´æ–°é€²åº¦æ¢
      function updateProgress() {
        document.getElementById('progressFill').style.width =
          ((currentSection+1)/sections.length*100)+'%';
      }

      
        

        // æ–°å¢å ´ç«™
        function addStation() {
            if (stationCount >= 5) {
                showMessage('æœ€å¤šåªèƒ½æ–°å¢5å€‹å ´ç«™', 'error');
                return;
            }
            
            stationCount++;
            const container = document.getElementById('stationsContainer');
            const newStation = document.createElement('div');
            newStation.className = 'station-entry';
            newStation.innerHTML = `
                <h4>å ´ç«™ ${stationCount}</h4>
                <div class="form-row">
                    <div class="form-field">
                        <label>å ´ç«™åç¨±</label>
                        <input type="text" class="station-name">
                    </div>
                    <div class="form-field">
                        <label>åœæ”¾é¢ç© (å¹³æ–¹å…¬å°º)</label>
                        <input type="number" class="station-area">
                    </div>
                    <div class="form-field">
                        <label>æ ¼ä½æ•¸</label>
                        <input type="number" class="station-spaces" onchange="calculateParkingRatio()">
                    </div>
                </div>
                <button type="button" class="btn btn-danger" onclick="removeStation(this)" style="margin-top: 10px;">ç§»é™¤å ´ç«™</button>
            `;
            container.appendChild(newStation);
        }

        // ç§»é™¤å ´ç«™
        function removeStation(button) {
            if (stationCount <= 1) {
                showMessage('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹å ´ç«™', 'error');
                return;
            }
            button.parentElement.remove();
            stationCount--;
            // é‡æ–°ç·¨è™Ÿå ´ç«™
            const stations = document.querySelectorAll('.station-entry');
            stations.forEach((station, index) => {
                station.querySelector('h4').textContent = `å ´ç«™ ${index + 1}`;
            });
            calculateParkingRatio();
        }

        // è¨ˆç®—åœè»Šæ ¼æ¯”ä¾‹
        function calculateParkingRatio() {
            const totalVehicles = parseFloat(document.getElementById('totalVehicles').value) || 0;
            const spaces = document.querySelectorAll('.station-spaces');
            let totalSpaces = 0;
            
            spaces.forEach(space => {
                totalSpaces += parseFloat(space.value) || 0;
            });
            
            const ratio = totalVehicles > 0 ? (totalSpaces / totalVehicles * 100).toFixed(2) : 0;
            document.getElementById('parkingRatio').textContent = `åœè»Šæ ¼æ•¸å ç¸½è»Šæ•¸æ¯”ä¾‹ï¼š${ratio}% (${totalSpaces}/${totalVehicles})`;
        }

        // è¨ˆç®—è»Šè¼›é¡å‹åˆ†ä½ˆ
        function calculateEmissionRatio() {
            const total = parseFloat(document.getElementById('totalVehiclesB3').value) || 0;
            const diesel = parseFloat(document.getElementById('dieselVehicles').value) || 0;
            const electric = parseFloat(document.getElementById('electricVehicles').value) || 0;
            const hybrid = parseFloat(document.getElementById('hybridVehicles').value) || 0;
            const gasoline = parseFloat(document.getElementById('gasolineVehicles').value) || 0;
            const other = parseFloat(document.getElementById('otherVehicles').value) || 0;
            
            const sum = diesel + electric + hybrid + gasoline + other;
            
            if (total > 0 && sum > 0) {
                document.getElementById('emissionRatio').innerHTML = `
                    è»Šè¼›é¡å‹åˆ†ä½ˆï¼š<br>
                    æŸ´æ²¹è»Šï¼š${(diesel/total*100).toFixed(1)}% (${diesel}è¼›)<br>
                    é›»å‹•è»Šï¼š${(electric/total*100).toFixed(1)}% (${electric}è¼›)<br>
                    æ²¹é›»æ··åˆï¼š${(hybrid/total*100).toFixed(1)}% (${hybrid}è¼›)<br>
                    æ±½æ²¹è»Šï¼š${(gasoline/total*100).toFixed(1)}% (${gasoline}è¼›)<br>
                    å…¶ä»–ï¼š${(other/total*100).toFixed(1)}% (${other}è¼›)
                `;
            } else {
                document.getElementById('emissionRatio').textContent = 'è»Šè¼›é¡å‹åˆ†ä½ˆï¼šè«‹è¼¸å…¥ç›¸é—œæ•¸æ“š';
            }
        }

        // è¨ˆç®—é›»å‹•è»Šæ¯”ç‡
        function calculateElectricRatio() {
            const total = parseFloat(document.getElementById('totalVehiclesB7').value) || 0;
            const electric = parseFloat(document.getElementById('electricVehiclesB7').value) || 0;
            const ratio = total > 0 ? (electric / total * 100).toFixed(2) : 0;
            document.getElementById('electricRatio').textContent = `é›»å‹•è»Šæ¯”ç‡ï¼š${ratio}% (${electric}/${total})`;
        }

        // è¨ˆç®—è‚‡äº‹ç‡
        function calculateAccidentRate() {
            const mileage = parseFloat(document.getElementById('totalMileage').value) || 0;
            const a1 = parseFloat(document.getElementById('a1Accidents').value) || 0;
            const a2 = parseFloat(document.getElementById('a2Accidents').value) || 0;
            
            if (mileage > 0) {
                const rate = ((a1 + a2) / mileage * 100000).toFixed(3);
                document.getElementById('accidentRate').textContent = `æ¯åè¬å»¶è»Šå…¬é‡Œè‚‡äº‹ç‡ï¼š${rate}æ¬¡ (A1:${a1}æ¬¡, A2:${a2}æ¬¡)`;
            } else {
                document.getElementById('accidentRate').textContent = 'æ¯åè¬å»¶è»Šå…¬é‡Œè‚‡äº‹ç‡ï¼šè«‹è¼¸å…¥é‡Œç¨‹æ•¸';
            }
        }

        // è¨ˆç®—é•è¦ç‡
        function calculateViolationRate() {
            const mileage = parseFloat(document.getElementById('totalMileage').value) || 0;
            const violations = parseFloat(document.getElementById('trafficViolations').value) || 0;
            
            if (mileage > 0) {
                const rate = (violations / mileage * 100000).toFixed(3);
                document.getElementById('violationRate').textContent = `æ¯åè¬å»¶è»Šå…¬é‡Œé•è¦ç‡ï¼š${rate}æ¬¡`;
            } else {
                document.getElementById('violationRate').textContent = 'æ¯åè¬å»¶è»Šå…¬é‡Œé•è¦ç‡ï¼šè«‹è¼¸å…¥é‡Œç¨‹æ•¸';
            }
        }

        // è¨ˆç®—å‹åŸºæ³•é•è¦ç‡
        function calculateLaborViolationRate() {
            const mileage = parseFloat(document.getElementById('totalMileageD10').value) || 0;
            const violations = parseFloat(document.getElementById('laborViolations').value) || 0;
            
            if (mileage > 0) {
                const rate = (violations / mileage * 100000).toFixed(3);
                document.getElementById('laborViolationRate').textContent = `æ¯åè¬å»¶è»Šå…¬é‡Œé•åå‹åŸºæ³•æ¬¡æ•¸ï¼š${rate}æ¬¡`;
            } else {
                document.getElementById('laborViolationRate').textContent = 'æ¯åè¬å»¶è»Šå…¬é‡Œé•åå‹åŸºæ³•æ¬¡æ•¸ï¼šè«‹è¼¸å…¥é‡Œç¨‹æ•¸';
            }
        }

        // è¨ˆç®—ç„¡éšœç¤™è»Šè¼›æ¯”ç‡
        function calculateAccessibleRatio() {
            const total = parseFloat(document.getElementById('accessibleTotal').value) || 0;
            const accessible = parseFloat(document.getElementById('accessibleVehicles').value) || 0;
            const ratio = total > 0 ? (accessible / total * 100).toFixed(2) : 0;
            document.getElementById('accessibleRatio').textContent = `ç„¡éšœç¤™å…¬è»Šå æ¯”ï¼š${ratio}% (${accessible}/${total})`;
        }

        // è¨ˆç®—æ”¹å–„æ¯”ç‡
        function calculateImprovementRatio() {
            const prevStop = parseFloat(document.getElementById('prevStopDefects').value) || 0;
            const improvedStop = parseFloat(document.getElementById('improvedStopDefects').value) || 0;
            const prevVehicle = parseFloat(document.getElementById('prevVehicleDefects').value) || 0;
            const improvedVehicle = parseFloat(document.getElementById('improvedVehicleDefects').value) || 0;
            
            const stopRatio = prevStop > 0 ? (improvedStop / prevStop * 100).toFixed(2) : 0;
            const vehicleRatio = prevVehicle > 0 ? (improvedVehicle / prevVehicle * 100).toFixed(2) : 0;
            
            document.getElementById('improvementRatio').innerHTML = `
                ç«™ç‰Œç¼ºå¤±æ”¹å–„æ¯”ç‡ï¼š${stopRatio}% (${improvedStop}/${prevStop})<br>
                éš¨è»Šè¨­å‚™ç¼ºå¤±æ”¹å–„æ¯”ç‡ï¼š${vehicleRatio}% (${improvedVehicle}/${prevVehicle})
            `;
        }

        // è‡ªå‹•ä¿å­˜
        function autoSave() {
            saveProgress(true);
        }

        // å„²å­˜é€²åº¦
        function saveProgress(isAuto = false) {
            const formData = collectFormData();
            
            // å„²å­˜åˆ°è¨˜æ†¶é«” (ä¸ä½¿ç”¨localStorage)
            window.savedFormData = formData;
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            if (!isAuto) {
                showMessage('é€²åº¦å·²å„²å­˜ï¼', 'success');
            }
        }

        // è¼‰å…¥é€²åº¦
        function loadProgress() {
            if (window.savedFormData) {
                const formData = window.savedFormData;
                
                // æ¢å¾©è¡¨å–®è³‡æ–™
                Object.keys(formData).forEach(key => {
                    if (key === 'stations') return; // å ´ç«™è³‡æ–™å¦å¤–è™•ç†
                    
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = formData[key];
                        } else {
                            element.value = formData[key];
                        }
                    }
                });
                
                // æ¢å¾©å ´ç«™è³‡æ–™
                if (formData.stations && formData.stations.length > 1) {
                    // ç§»é™¤é è¨­å ´ç«™å¤–çš„å…¶ä»–å ´ç«™
                    const container = document.getElementById('stationsContainer');
                    const stationEntries = container.querySelectorAll('.station-entry');
                    for (let i = 1; i < stationEntries.length; i++) {
                        stationEntries[i].remove();
                    }
                    
                    // é‡æ–°æ·»åŠ å ´ç«™
                    stationCount = 1;
                    for (let i = 1; i < formData.stations.length; i++) {
                        addStation();
                    }
                    
                    // å¡«å…¥å ´ç«™è³‡æ–™
                    formData.stations.forEach((station, index) => {
                        const stationEntry = container.children[index];
                        if (stationEntry) {
                            stationEntry.querySelector('.station-name').value = station.name || '';
                            stationEntry.querySelector('.station-area').value = station.area || '';
                            stationEntry.querySelector('.station-spaces').value = station.spaces || '';
                        }
                    });
                }
                
                // é‡æ–°è¨ˆç®—æ‰€æœ‰æ¯”ç‡
                recalculateAllRatios();
                
                // è§¸ç™¼è·¯ç·šé¡å‹è®Šæ›´äº‹ä»¶
                const routeTypeSelect = document.getElementById('routeType');
                if (routeTypeSelect.value) {
                    routeTypeSelect.dispatchEvent(new Event('change'));
                }
            }
        }

        // é‡æ–°è¨ˆç®—æ‰€æœ‰æ¯”ç‡
        function recalculateAllRatios() {
            calculateParkingRatio();
            calculateEmissionRatio();
            calculateElectricRatio();
            calculateAccidentRate();
            calculateViolationRate();
            calculateLaborViolationRate();
            calculateAccessibleRatio();
            calculateImprovementRatio();
        }

        // æäº¤è¡¨å–®
        let lastSubmittedId = null;
        async function submitForm() {
            if (!validateForm()) return;
            
            const formData = collectFormData();
            
            // é¡¯ç¤ºæäº¤ä¸­çš„è¨Šæ¯
            showMessage('æ­£åœ¨æäº¤è¡¨å–®...', 'success');
            
            try {
                console.log('æäº¤çš„è³‡æ–™:', formData); // é™¤éŒ¯ç”¨
                
                const response = await fetch('/api/save', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(formData),
                });
                
                console.log('å›æ‡‰ç‹€æ…‹:', response.status); // é™¤éŒ¯ç”¨
                console.log('å›æ‡‰ OK:', response.ok); // é™¤éŒ¯ç”¨
                
                // æª¢æŸ¥ HTTP ç‹€æ…‹ç¢¼
                if (!response.ok) {
                    // å˜—è©¦ç²å–éŒ¯èª¤è¨Šæ¯
                    let errorMessage = `HTTP ${response.status}`;
                    try {
                        const errorData = await response.text();
                        console.log('éŒ¯èª¤å›æ‡‰å…§å®¹:', errorData); // é™¤éŒ¯ç”¨
                        
                        // å˜—è©¦è§£æç‚º JSON
                        try {
                            const errorJson = JSON.parse(errorData);
                            errorMessage = errorJson.message || errorJson.error || errorMessage;
                        } catch {
                            // å¦‚æœä¸æ˜¯ JSONï¼Œä½¿ç”¨æ–‡å­—å…§å®¹
                            errorMessage = errorData || errorMessage;
                        }
                    } catch {
                        // ç„¡æ³•è®€å–éŒ¯èª¤å…§å®¹
                    }
                    
                    throw new Error(errorMessage);
                }
                
                // è™•ç†æˆåŠŸå›æ‡‰
                let result = {};
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    // å¦‚æœæ˜¯ JSON å›æ‡‰
                    result = await response.json();
                } else if (response.status !== 204) {
                    // å¦‚æœä¸æ˜¯ No Contentï¼Œå˜—è©¦è®€å–æ–‡å­—
                    const textResult = await response.text();
                    console.log('æ–‡å­—å›æ‡‰:', textResult);
                    
                    // å˜—è©¦è§£æç‚º JSON
                    try {
                        result = JSON.parse(textResult);
                    } catch {
                        result = { message: textResult };
                    }
                }
                
                console.log('æˆåŠŸçµæœ:', result); // é™¤éŒ¯ç”¨
                
                // ç²å– ID
                const id = result.id || result.dataId || result.uuid || generateTempId();
                
                if (id) {
                    window.lastSubmitId = id;
                    if (typeof(Storage) !== "undefined") {
                        sessionStorage.setItem('lastSubmitId', id);
                    }
                }
                
                // æ¸…é™¤è‰ç¨¿
                delete window.savedFormData;
                if (typeof(Storage) !== "undefined") {
                    localStorage.removeItem('formData');
                }
                
                // é¡¯ç¤ºæˆåŠŸå½ˆçª—
                showSuccessModal(id);
                
                // ä¹Ÿé¡¯ç¤ºå‚³çµ±è¨Šæ¯ä½œç‚ºå‚™ç”¨
                showMessage(`æäº¤æˆåŠŸï¼${id ? `è³‡æ–™ IDï¼š${id}` : ''}`, 'success');
                
                // å•Ÿç”¨åŒ¯å‡ºæŒ‰éˆ•
                const exportBtn = document.querySelector('[onclick="exportExcel()"]');
                if (exportBtn) {
                    exportBtn.disabled = false;
                }
                
            } catch (error) {
                console.error('æäº¤éŒ¯èª¤:', error); // é™¤éŒ¯ç”¨
                
                // æ ¹æ“šéŒ¯èª¤é¡å‹é¡¯ç¤ºä¸åŒè¨Šæ¯
                let errorMessage = 'æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
                
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'ç¶²è·¯é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯å¾Œé‡è©¦';
                } else if (error.message.includes('NetworkError')) {
                    errorMessage = 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€£ç·š';
                } else if (error.message.includes('HTTP 500')) {
                    errorMessage = 'ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ï¼Œä½†è³‡æ–™å¯èƒ½å·²å„²å­˜ï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡';
                } else if (error.message.includes('HTTP 400')) {
                    errorMessage = 'è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥å¡«å¯«å…§å®¹';
                } else if (error.message.includes('HTTP 404')) {
                    errorMessage = 'API ç«¯é»æœªæ‰¾åˆ°ï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡';
                } else if (error.message && error.message !== 'undefined') {
                    errorMessage = `æäº¤å¤±æ•—ï¼š${error.message}`;
                }
                
                showMessage(errorMessage, 'error');
                
                // å¦‚æœå¯èƒ½æ˜¯æˆåŠŸä½†å›æ‡‰æ ¼å¼å•é¡Œï¼Œçµ¦äºˆæç¤º
                if (error.message.includes('HTTP 500') || error.message.includes('SyntaxError')) {
                    setTimeout(() => {
                        showMessage('å¦‚æœçœ‹åˆ°æ­¤è¨Šæ¯ï¼Œè«‹æª¢æŸ¥è³‡æ–™åº«æ˜¯å¦å·²æœ‰æ‚¨çš„è³‡æ–™', 'success');
                    }, 3000);
                }
            }
        }

        // ç”Ÿæˆè‡¨æ™‚ ID çš„è¼”åŠ©å‡½æ•¸
        function generateTempId() {
            return 'temp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // æ”¹é€²çš„éŒ¯èª¤è¨Šæ¯é¡¯ç¤ºå‡½æ•¸
        function showMessage(message, type, duration = 5000) {
            // ç§»é™¤ç¾æœ‰è¨Šæ¯
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = message;
            
            // æ·»åŠ é—œé–‰æŒ‰éˆ•
            const closeBtn = document.createElement('span');
            closeBtn.innerHTML = '&times;';
            closeBtn.style.cssText = `
                float: right;
                cursor: pointer;
                font-size: 20px;
                font-weight: bold;
                margin-left: 10px;
            `;
            closeBtn.onclick = () => messageDiv.remove();
            messageDiv.appendChild(closeBtn);
            
            document.body.appendChild(messageDiv);
            
            // è‡ªå‹•ç§»é™¤è¨Šæ¯
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, duration);
        }

        // é¡¯ç¤ºæˆåŠŸæäº¤å½ˆçª—
        function showSuccessModal(submissionId) {
            // å‰µå»ºå½ˆçª— HTML
            const modalHTML = `
                <div class="success-modal" id="successModal">
                    <div class="success-modal-content">
                        <div class="success-icon"></div>
                        <h2 class="success-title">æäº¤æˆåŠŸï¼</h2>
                        <p class="success-message">
                            æ‚¨çš„æ¡ƒåœ’å¸‚å…¬è»Šç‡Ÿé‹è©•é‘‘è¡¨å–®å·²æˆåŠŸæäº¤<br>
                            æ„Ÿè¬æ‚¨çš„é…åˆèˆ‡å¡«å¯«
                        </p>
                        ${submissionId ? `
                        <div class="success-details">
                            <strong>æäº¤ç·¨è™Ÿï¼š</strong>${submissionId}<br>
                            <strong>æäº¤æ™‚é–“ï¼š</strong>${new Date().toLocaleString('zh-TW')}
                        </div>
                        ` : ''}
                        <div class="success-buttons">
                            <button class="modal-btn modal-btn-primary" onclick="closeSuccessModal()">ç¢ºå®š</button>
                            <button class="modal-btn modal-btn-secondary" onclick="printForm()">åˆ—å°è¡¨å–®</button>
                        </div>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°é é¢
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // é¡¯ç¤ºå½ˆçª—
            setTimeout(() => {
                document.getElementById('successModal').classList.add('show');
            }, 100);
            
            // æ·»åŠ å½©å¸¶æ•ˆæœ
            createConfetti();
            
            // æ’­æ”¾æˆåŠŸéŸ³æ•ˆï¼ˆå¦‚æœç€è¦½å™¨æ”¯æ´ï¼‰
            playSuccessSound();
        }

        // é—œé–‰æˆåŠŸå½ˆçª—
        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        // å‰µå»ºå½©å¸¶æ•ˆæœ
        function createConfetti() {
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];
            const modal = document.getElementById('successModal');
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    modal.appendChild(confetti);
                    
                    // ç§»é™¤å½©å¸¶
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.remove();
                        }
                    }, 4000);
                }, i * 100);
            }
        }

        // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
        function playSuccessSound() {
            try {
                // å‰µå»ºéŸ³é »ä¸Šä¸‹æ–‡
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // å‰µå»ºæˆåŠŸéŸ³æ•ˆ
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {
                // å¦‚æœéŸ³é » API ä¸æ”¯æ´ï¼Œéœé»˜å¤±æ•—
                console.log('éŸ³é »æ’­æ”¾ä¸æ”¯æ´:', error);
            }
        }

        // åˆ—å°è¡¨å–®
        function printForm() {
            window.print();
        }

        // é™¤éŒ¯æ¨¡å¼ï¼šæª¢æŸ¥å¾Œç«¯ API ç‹€æ…‹
        async function checkApiStatus() {
            try {
                const response = await fetch('/api/status', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                console.log('API ç‹€æ…‹æª¢æŸ¥:', {
                    status: response.status,
                    ok: response.ok,
                    headers: [...response.headers.entries()]
                });
                
                const text = await response.text();
                console.log('API å›æ‡‰å…§å®¹:', text);
                
            } catch (error) {
                console.log('API ç‹€æ…‹æª¢æŸ¥å¤±æ•—:', error);
            }
        }

        // åœ¨é é¢è¼‰å…¥æ™‚æª¢æŸ¥ API ç‹€æ…‹ï¼ˆé™¤éŒ¯ç”¨ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            // åªåœ¨é–‹ç™¼ç’°å¢ƒåŸ·è¡Œ
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                checkApiStatus();
            }
            
            // é»æ“Šå½ˆçª—èƒŒæ™¯é—œé–‰å½ˆçª—
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('success-modal')) {
                    closeSuccessModal();
                }
            });
            
            // ESC éµé—œé–‰å½ˆçª—
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeSuccessModal();
                }
            });
        });

    

        // è¡¨å–®é©—è­‰
        function validateForm() {
            const requiredFields = ['companyName', 'fillPerson', 'fillDate', 'totalVehicles'];
            let isValid = true;
            let errorMessages = [];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = '#dc3545';
                    errorMessages.push(`è«‹å¡«å¯« ${field.previousElementSibling.textContent}`);
                    isValid = false;
                } else {
                    field.style.borderColor = '#dee2e6';
                }
            });
            
            // æª¢æŸ¥æ•¸å€¼åˆç†æ€§
            const totalVehicles = parseFloat(document.getElementById('totalVehicles').value) || 0;
            if (totalVehicles <= 0) {
                errorMessages.push('ç¸½è»Šè¼›æ•¸å¿…é ˆå¤§æ–¼0');
                isValid = false;
            }
            
            // æª¢æŸ¥å ´ç«™æ ¼ä½æ•¸ç¸½å’Œ
            const spaces = document.querySelectorAll('.station-spaces');
            let totalSpaces = 0;
            spaces.forEach(space => {
                totalSpaces += parseFloat(space.value) || 0;
            });
            
            if (totalSpaces > totalVehicles * 2) {
                errorMessages.push('åœè»Šæ ¼ä½æ•¸ä¼¼ä¹éå¤šï¼Œè«‹æª¢æŸ¥æ˜¯å¦æ­£ç¢º');
            }
            
            // æª¢æŸ¥ä¸‹æ‹‰é¸å–®æ˜¯å¦é‚„æ˜¯é è¨­å€¼ã€Œè«‹é¸æ“‡ã€
            const dropdowns = document.querySelectorAll('select');
            dropdowns.forEach(dropdown => {
                if (dropdown.value === '' || dropdown.value === 'è«‹é¸æ“‡') {
                    dropdown.style.borderColor = '#dc3545';
                    const label = dropdown.previousElementSibling;
                    const labelText = label ? label.textContent.replace('*', '').trim() : 'ä¸‹æ‹‰é¸å–®';
                    errorMessages.push(`è«‹é¸æ“‡ ${labelText}`);
                    isValid = false;
                } else {
                    dropdown.style.borderColor = '#dee2e6';
                }
            });
            
            if (!isValid) {
                showMessage(errorMessages.join('<br>'), 'error');
            }
            
            return isValid;
        }

        // æ”¶é›†è¡¨å–®è³‡æ–™
        function collectFormData() {
        const formData = {};

        // 1. æ”¶é›†æ‰€æœ‰è¼¸å…¥å…ƒä»¶
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            // 2. **æ’é™¤æ²’æœ‰ id çš„å…ƒç´ ï¼Œé¿å…ç”¢ç”Ÿ "" æ¬„ä½**
            if (!input.id) return;

            // 3. ä¾å…ƒä»¶å‹åˆ¥å¯«å…¥å€¼
            formData[input.id] =
                input.type === 'checkbox' ? input.checked : input.value;
        });

            
            // æ”¶é›†å ´ç«™è³‡æ–™
            const stations = [];
            document.querySelectorAll('.station-entry').forEach((station, index) => {
                stations.push({
                    name: station.querySelector('.station-name').value,
                    area: station.querySelector('.station-area').value,
                    spaces: station.querySelector('.station-spaces').value
                });
            });
            formData.stations = stations;
            
            // æ·»åŠ æ™‚é–“æˆ³è¨˜
            formData.lastModified = new Date().toISOString();
            
            return formData;
        }

        // Excel åŒ¯å‡ºåŠŸèƒ½
// ------------------------------
        async function exportExcel () {
        // 1. å…ˆç¢ºèªå·²æˆåŠŸæäº¤ï¼Œä¸¦ä¸” submitForm() æœ‰æŠŠ ID å­˜åˆ°å…¨åŸŸ
        const id = window.lastSubmitId;       // submitForm æˆåŠŸæ™‚è«‹åŠ ï¼šwindow.lastSubmitId = result.id;
        if (!id) {
            alert('è«‹å…ˆæäº¤è¡¨å–®ï¼Œæ‰å¯ä»¥åŒ¯å‡º Excelï¼');
            return;
        }

        // 2. å‘¼å«å¾Œç«¯ /api/export?id=...
        const res = await fetch(`/api/export?id=${id}`);
        if (!res.ok) {
            alert('åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            return;
        }
        const blob = await res.blob();

        // 3. ç”Ÿæˆä¸‹è¼‰é€£çµä¸¦è‡ªå‹•é»æ“Š
        const url = URL.createObjectURL(blob);
        const a   = document.createElement('a');
        a.href = url;
        a.download = `evaluation_${id}.xlsx`;
        a.click();
        URL.revokeObjectURL(url);
        }

        // åŒ¯å‡ºè³‡æ–™
        function exportData() {
            const formData = collectFormData();
            
            // å‰µå»ºå¯ä¸‹è¼‰çš„JSONæª”æ¡ˆ
            const dataStr = JSON.stringify(formData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `æ¡ƒåœ’å¸‚å…¬è»Šè©•é‘‘è³‡æ–™_${formData.companyName || 'æœªå‘½å'}_${new Date().toISOString().split('T')[0]}.json`;
            
            // å‰µå»ºä¸¦é»æ“Šä¸‹è¼‰é€£çµ
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('è³‡æ–™åŒ¯å‡ºæˆåŠŸï¼', 'success');
        }

        // é‡ç½®è¡¨å–®
        function resetForm() {
            if (!confirm('ç¢ºå®šè¦é‡ç½®è¡¨å–®å—ï¼Ÿæ‰€æœ‰å·²å¡«å¯«çš„è³‡æ–™å°‡æœƒéºå¤±ã€‚')) {
                return;
            }
            
            // é‡ç½®æ‰€æœ‰è¡¨å–®æ¬„ä½
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else if (input.type === 'date') {
                    input.value = new Date().toISOString().split('T')[0];
                } else {
                    input.value = '';
                }
            });
            
            // é‡ç½®å ´ç«™ç‚ºé è¨­ç‹€æ…‹
            const container = document.getElementById('stationsContainer');
            container.innerHTML = `
                <div class="station-entry">
                    <h4>å ´ç«™ 1</h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label>å ´ç«™åç¨±</label>
                            <input type="text" class="station-name">
                        </div>
                        <div class="form-field">
                            <label>åœæ”¾é¢ç© (å¹³æ–¹å…¬å°º)</label>
                            <input type="number" class="station-area">
                        </div>
                        <div class="form-field">
                            <label>æ ¼ä½æ•¸</label>
                            <input type="number" class="station-spaces" onchange="calculateParkingRatio()">
                        </div>
                    </div>
                </div>
            `;
            stationCount = 1;
            
            // é‡ç½®è·¯ç·šé¡å‹ç›¸é—œé¡¯ç¤º
            document.getElementById('otherRouteFields').style.display = 'none';
            
            // æ¸…é™¤å·²ä¿å­˜çš„è³‡æ–™
            delete window.savedFormData;
            
            // é‡æ–°è¨ˆç®—æ‰€æœ‰æ¯”ç‡
            recalculateAllRatios();
            
            // å›åˆ°ç¬¬ä¸€é 
            currentSection = 0;
            showSectionById('basic');
            
            showMessage('è¡¨å–®å·²é‡ç½®ï¼', 'success');
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type) {
            // ç§»é™¤ç¾æœ‰è¨Šæ¯
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = message;
            
            document.body.appendChild(messageDiv);
            
            // 3ç§’å¾Œè‡ªå‹•ç§»é™¤è¨Šæ¯
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }

        // åŒ¯å…¥è³‡æ–™åŠŸèƒ½
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (!confirm('ç¢ºå®šè¦åŒ¯å…¥è³‡æ–™å—ï¼Ÿé€™å°‡è¦†è“‹ç›®å‰æ‰€æœ‰è³‡æ–™ã€‚')) {
                                return;
                            }
                            
                            // å„²å­˜åŒ¯å…¥çš„è³‡æ–™
                            window.savedFormData = importedData;
                            
                            // è¼‰å…¥è³‡æ–™
                            loadProgress();
                            
                            showMessage('è³‡æ–™åŒ¯å…¥æˆåŠŸï¼', 'success');
                        } catch (error) {
                            showMessage('æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼Œè«‹é¸æ“‡æœ‰æ•ˆçš„JSONæª”æ¡ˆã€‚', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // åˆ—å°åŠŸèƒ½
        function printForm() {
            const formData = collectFormData();
            const printWindow = window.open('', '_blank');
            
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>æ¡ƒåœ’å¸‚å…¬è»Šç‡Ÿé‹è©•é‘‘å¡«å ±è³‡æ–™</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .section { margin-bottom: 25px; }
                        .section h2 { color: #2193b0; border-bottom: 2px solid #2193b0; padding-bottom: 5px; }
                        .field { margin: 10px 0; }
                        .field label { font-weight: bold; }
                        .checkbox-list { margin-left: 20px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>114å¹´åº¦æ¡ƒåœ’å¸‚å¸‚å€æ±½è»Šå®¢é‹ç‡Ÿé‹èˆ‡æœå‹™è©•é‘‘</h1>
                        <h2>æ›¸é¢è³‡æ–™å¯©æŸ¥å¡«å ±è³‡æ–™</h2>
                        <p>å¡«å ±æ—¥æœŸï¼š${formData.fillDate || 'æœªå¡«å¯«'}</p>
                    </div>
                    
                    <div class="section">
                        <h2>åŸºæœ¬è³‡æ–™</h2>
                        <div class="field"><label>å…¬å¸åç¨±ï¼š</label>${formData.companyName || ''}</div>
                        <div class="field"><label>å¡«å¯«äººå“¡ï¼š</label>${formData.fillPerson || ''}</div>
                        <div class="field"><label>ç¸½è»Šè¼›æ•¸ï¼š</label>${formData.totalVehicles || ''}</div>
                    </div>
                    
                    ${generatePrintSections(formData)}
                    
                    <div style="margin-top: 50px; text-align: center; color: #666;">
                        <p>æ­¤è¡¨å–®ç”±æ¡ƒåœ’å¸‚å…¬è»Šç‡Ÿé‹è©•é‘‘å¡«å ±ç³»çµ±ç”¢ç”Ÿ</p>
                        <p>ç”¢ç”Ÿæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}</p>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // ç”¢ç”Ÿåˆ—å°ç”¨çš„å€æ®µå…§å®¹
        function generatePrintSections(formData) {
            let content = '';
            
            // å ´ç«™è³‡æ–™
            if (formData.stations && formData.stations.length > 0) {
                content += '<div class="section"><h2>å ´ç«™è³‡æ–™</h2>';
                formData.stations.forEach((station, index) => {
                    if (station.name || station.area || station.spaces) {
                        content += `
                            <div class="field">
                                <label>å ´ç«™ ${index + 1}ï¼š</label>
                                ${station.name || 'æœªå‘½å'} 
                                (é¢ç©ï¼š${station.area || '0'}å¹³æ–¹å…¬å°º, æ ¼ä½ï¼š${station.spaces || '0'}å€‹)
                            </div>
                        `;
                    }
                });
                content += '</div>';
            }
            
            // å…¶ä»–é‡è¦æ•¸æ“š
            const importantFields = [
                { key: 'avgAge', label: 'å¹³å‡è»Šé½¡', unit: 'å¹´' },
                { key: 'electricVehiclesB7', label: 'é›»å‹•è»Šæ•¸é‡', unit: 'è¼›' },
                { key: 'totalMileage', label: 'æœŸé–“ç¸½é‡Œç¨‹æ•¸', unit: 'å…¬é‡Œ' },
                { key: 'a1Accidents', label: 'A1äº‹æ•…ä»¶æ•¸', unit: 'æ¬¡' },
                { key: 'a2Accidents', label: 'A2äº‹æ•…ä»¶æ•¸', unit: 'æ¬¡' },
                { key: 'trafficViolations', label: 'äº¤é€šé•è¦ä»¶æ•¸', unit: 'æ¬¡' }
            ];
            
            content += '<div class="section"><h2>é‡è¦çµ±è¨ˆæ•¸æ“š</h2>';
            importantFields.forEach(field => {
                if (formData[field.key]) {
                    content += `<div class="field"><label>${field.label}ï¼š</label>${formData[field.key]} ${field.unit}</div>`;
                }
            });
            content += '</div>';
            
            return content;
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveProgress();
                        break;
                    case 'p':
                        e.preventDefault();
                        printForm();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        prevSection();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        nextSection();
                        break;
                }
            }
        });

        // æ·»åŠ å¿«æ·éµæç¤º
        function showShortcuts() {
            const shortcuts = `
                <div style="font-size: 14px; line-height: 1.6;">
                    <strong>éµç›¤å¿«æ·éµï¼š</strong><br>
                    Ctrl + Sï¼šå„²å­˜é€²åº¦<br>
                    Ctrl + Pï¼šåˆ—å°è¡¨å–®<br>
                    Ctrl + â†ï¼šä¸Šä¸€é <br>
                    Ctrl + â†’ï¼šä¸‹ä¸€é 
                </div>
            `;
            showMessage(shortcuts, 'success');
        }

        // åœ¨é é¢åº•éƒ¨æ·»åŠ å¿«æ·éµæç¤ºæŒ‰éˆ•
        window.onload = function() {
            const helpButton = document.createElement('button');
            helpButton.textContent = '?';
            helpButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                z-index: 1000;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: #2193b0;
                color: white;
                border: none;
                font-size: 18px;
                cursor: pointer;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            helpButton.onclick = showShortcuts;
            helpButton.title = 'é¡¯ç¤ºéµç›¤å¿«æ·éµ';
            document.body.appendChild(helpButton);
        };
    </script>
</body>
</html>
